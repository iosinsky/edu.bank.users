<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">
    <changeSet author="v.livshic" id="init">
        <!-- На старой БД это изменение излишне -->
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="app_user"/>
            </not>
        </preConditions>
        <!--        <createSequence sequenceName="hibernate_sequence"/>-->
        <sql>
            CREATE SEQUENCE hibernate_sequence;

            CREATE TABLE app_role
            (
            id      bigint         NOT NULL primary key,
            code    varchar(64) not null,
            name    varchar(128) not null,
            system  boolean        NOT NULL
            );

            ALTER TABLE app_role
            ADD CONSTRAINT uk_app_role UNIQUE (code);

            CREATE TABLE app_role_authority
            (
            id              bigint    NOT NULL,
            authority_code  integer,
            role_id         bigint
            );

            ALTER TABLE app_role_authority
            ADD CONSTRAINT app_role_authority_pkey
            PRIMARY KEY (id);

            ALTER TABLE app_role_authority
            ADD CONSTRAINT fk_app_role_authority_role FOREIGN KEY (role_id)
            REFERENCES app_role (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE app_role_authority
            ADD CONSTRAINT uk_app_role_authority UNIQUE (role_id, authority_code);

            CREATE TABLE binary_data
            (
            id    bigint   NOT NULL primary key,
            data  oid
            );

            CREATE TABLE binary_info
            (
            id              bigint         NOT NULL primary key,
            guid            varchar(128),
            created         timestamp,
            updated         timestamp,
            binary_data_id  bigint,
            file_name       varchar(128),
            media_type      varchar(128),
            path            varchar(255),
            size            integer        NOT NULL
            );

            ALTER TABLE binary_info
            ADD CONSTRAINT fk_binary_info_binary_data FOREIGN KEY (binary_data_id)
            REFERENCES binary_data (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE binary_info
            ADD CONSTRAINT uk_binary_info UNIQUE (guid);

            CREATE TABLE organization_group
            (
            id                          bigint         NOT NULL primary key,
            created                     timestamp,
            updated                     timestamp,
            active                      boolean        NOT NULL,
            deleted                     boolean        NOT NULL,
            main_color                  varchar(255),
            name                        varchar(255),
            logo_id                     bigint,
            logo_mini_id                bigint,
            background_image_file_name  varchar(255)
            );

            ALTER TABLE organization_group
            ADD CONSTRAINT fk_organization_group_binary_info FOREIGN KEY (logo_id)
            REFERENCES binary_info (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE organization_group
            ADD CONSTRAINT fk_organization_group_binary_info_mini FOREIGN KEY (logo_mini_id)
            REFERENCES binary_info (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            CREATE TABLE organization
            (
            id              bigint          NOT NULL primary key,
            created         timestamp,
            updated         timestamp,
            active          boolean         NOT NULL,
            actual_address  varchar(512),
            deleted         boolean         NOT NULL,
            email           varchar(64),
            full_name       varchar(255),
            group_id        bigint,
            inn             varchar(64),
            kpp             varchar(64),
            legal_address   varchar(512),
            legal_form      varchar(255),
            location        varchar(255),
            logo_id         bigint,
            notes           varchar(1024),
            ogrn            varchar(64),
            phone           varchar(64),
            postal_address  varchar(512),
            short_name      varchar(128),
            site            varchar(64)
            );

            ALTER TABLE organization
            ADD CONSTRAINT fk_organization_binary_info FOREIGN KEY (logo_id)
            REFERENCES binary_info (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE organization
            ADD CONSTRAINT fk_organization_org_group FOREIGN KEY (group_id)
            REFERENCES organization_group (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            CREATE TABLE app_user
            (
            id                    bigint          NOT NULL primary key,
            created               timestamp,
            updated               timestamp,
            active                boolean         NOT NULL,
            addition_information  varchar(1024),
            agreement_accepted    boolean         NOT NULL,
            deleted               boolean         NOT NULL,
            email                 varchar(64)     NOT NULL,
            first_name            varchar(128),
            group_id              bigint,
            last_name             varchar(128),
            login                 varchar(64)     NOT NULL,
            middle_name           varchar(128),
            password              varchar(64),
            password_changed      boolean         NOT NULL,
            phone                 varchar(64),
            position              varchar(255),
            postal_address        varchar(512),
            avatar_id             bigint,
            preffered_locale      varchar(10)     DEFAULT 'ru'::character varying NOT NULL
            );



            ALTER TABLE app_user
            ADD CONSTRAINT fk_app_user_binary_info FOREIGN KEY (avatar_id)
            REFERENCES binary_info (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE app_user
            ADD CONSTRAINT fk_app_user_organization_group FOREIGN KEY (group_id)
            REFERENCES organization_group (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE app_user
            ADD CONSTRAINT uk_app_user_login UNIQUE (login);

            CREATE TABLE app_user_agreement
            (
            id        bigint         NOT NULL primary key,
            created   timestamp,
            updated   timestamp,
            document  bytea,
            title     varchar(255)
            );

            CREATE TABLE app_user_authority
            (
            id              bigint    NOT NULL primary key,
            authority_code  integer,
            user_id         bigint
            );

            ALTER TABLE app_user_authority
            ADD CONSTRAINT fk_app_user_authority_app_user FOREIGN KEY (user_id)
            REFERENCES app_user (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE app_user_authority
            ADD CONSTRAINT uk_app_user_authority UNIQUE (user_id, authority_code);

            CREATE TABLE app_user_role
            (
            user_id  bigint   NOT NULL,
            role_id  bigint   NOT NULL
            );

            ALTER TABLE app_user_role
            ADD CONSTRAINT fk_app_user_role_role FOREIGN KEY (role_id)
            REFERENCES app_role (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE app_user_role
            ADD CONSTRAINT fk_app_user_role_user FOREIGN KEY (user_id)
            REFERENCES app_user (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            CREATE TABLE contact
            (
            id                     bigint         NOT NULL primary key,
            type                   integer        NOT NULL,
            use_for_notifications  boolean        NOT NULL,
            user_id                bigint,
            value                  varchar(128)   NOT NULL
            );

            ALTER TABLE contact
            ADD CONSTRAINT fk_contact_user FOREIGN KEY (user_id)
            REFERENCES app_user (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            CREATE TABLE identity_document
            (
            id          bigint         NOT NULL primary key,
            issue_date  timestamp,
            issued_by   varchar(255),
            number      varchar(255),
            series      varchar(255),
            type        integer        NOT NULL,
            user_id     bigint
            );


            ALTER TABLE identity_document
            ADD CONSTRAINT fk_identity_document_user FOREIGN KEY (user_id)
            REFERENCES app_user (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            CREATE TABLE management_body
            (
            id                                    bigint         NOT NULL primary key,
            decisive_vote_chairman                boolean        NOT NULL,
            deleted                               boolean        NOT NULL,
            group_id                              bigint,
            management_body_member_actual_number  integer        NOT NULL,
            management_body_member_total_number   integer        NOT NULL,
            organization_id                       bigint,
            quorum                                integer        NOT NULL,
            title                                 varchar(255),
            title_genitive                        varchar(255)
            );

            ALTER TABLE management_body
            ADD CONSTRAINT fk_management_body FOREIGN KEY (organization_id)
            REFERENCES organization (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            CREATE TABLE management_body_admin
            (
            management_body_id  bigint   NOT NULL,
            user_id             bigint   NOT NULL
            );

            ALTER TABLE management_body_admin
            ADD CONSTRAINT fk_management_body_admin_user FOREIGN KEY (user_id)
            REFERENCES app_user (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE management_body_admin
            ADD CONSTRAINT fk_management_body_admin_body FOREIGN KEY (management_body_id)
            REFERENCES management_body (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            CREATE TABLE management_body_member
            (
            id                               bigint         NOT NULL PRIMARY KEY,
            authority_expiration_date        timestamp,
            authority_start_date             timestamp,
            is_independent                   boolean,
            management_body_id               bigint,
            management_body_member_position  varchar(255),
            user_id                          bigint
            );

            ALTER TABLE management_body_member
            ADD CONSTRAINT fk_management_body_member_user FOREIGN KEY (user_id)
            REFERENCES app_user (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE management_body_member
            ADD CONSTRAINT fk_management_body_member_body FOREIGN KEY (management_body_id)
            REFERENCES management_body (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE management_body_member
            ADD CONSTRAINT uq_m_body_member UNIQUE (user_id, management_body_id);

            CREATE TABLE management_body_secretary
            (
            management_body_id  bigint   NOT NULL,
            user_id             bigint   NOT NULL
            );

            ALTER TABLE management_body_secretary
            ADD CONSTRAINT fk_management_body_secretary_user FOREIGN KEY (user_id)
            REFERENCES app_user (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE management_body_secretary
            ADD CONSTRAINT fk_management_body_secretary_body FOREIGN KEY (management_body_id)
            REFERENCES management_body (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            CREATE TABLE meeting
            (
            id                         bigint         NOT NULL primary key,
            guid                       varchar(128),
            created                    timestamp,
            updated                    timestamp,
            address_voting_documents   varchar(128),
            deleted                    boolean        NOT NULL,
            description                varchar(512),
            finish_time                timestamp,
            finish_time_absentee_vote  timestamp,
            group_id                   bigint         NOT NULL,
            kind                       integer        NOT NULL,
            location                   varchar(128),
            management_body_id         bigint,
            organization_id            bigint,
            quorum                     integer        NOT NULL,
            start_time                 timestamp,
            start_time_absentee_votes  timestamp,
            status                     integer        NOT NULL,
            title                      varchar(128)
            );

            ALTER TABLE meeting
            ADD CONSTRAINT fk_meeting_body FOREIGN KEY (management_body_id)
            REFERENCES management_body (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE meeting
            ADD CONSTRAINT fk_meeting_organization FOREIGN KEY (organization_id)
            REFERENCES organization (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE meeting
            ADD CONSTRAINT uk_meeting UNIQUE (guid);

            CREATE INDEX idx_meeting_org_group ON meeting (group_id);


            CREATE TABLE meeting_acceptable_kind
            (
            id                  bigint         NOT NULL primary key,
            management_body_id  bigint,
            meeting_kind        varchar(255)
            );


            ALTER TABLE meeting_acceptable_kind
            ADD CONSTRAINT fk_meeting_acceptable_kind_body FOREIGN KEY (management_body_id)
            REFERENCES management_body (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            CREATE TABLE meeting_chat_message
            (
            id          bigint          NOT NULL primary key,
            created     timestamp,
            updated     timestamp,
            author_id   bigint,
            meeting_id  bigint          NOT NULL,
            message     varchar(1024)   NOT NULL
            );

            ALTER TABLE meeting_chat_message
            ADD CONSTRAINT fk_meeting_chat_message_user FOREIGN KEY (author_id)
            REFERENCES app_user (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE meeting_chat_message
            ADD CONSTRAINT fk_meeting_chat_message_meeting FOREIGN KEY (meeting_id)
            REFERENCES meeting (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            CREATE TABLE meeting_member
            (
            id                         bigint    NOT NULL primary key,
            chairman                   boolean   NOT NULL,
            invited_participant        boolean   NOT NULL,
            meeting_id                 bigint,
            secretary                  boolean   NOT NULL,
            user_id                    bigint,
            votes_counting             boolean   NOT NULL,
            is_management_body_member  boolean
            );

            ALTER TABLE meeting_member
            ADD CONSTRAINT fk_meeting_member_user FOREIGN KEY (user_id)
            REFERENCES app_user (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE meeting_member
            ADD CONSTRAINT fk_meeting_member_meeting FOREIGN KEY (meeting_id)
            REFERENCES meeting (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            CREATE TABLE meeting_member_special_opinion
            (
            id                 bigint          NOT NULL primary key,
            meeting_id         bigint,
            meeting_member_id  bigint,
            text               varchar(1024)
            );

            ALTER TABLE meeting_member_special_opinion
            ADD CONSTRAINT fk_meeting_member_special_opinion_meeting FOREIGN KEY (meeting_id)
            REFERENCES meeting (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE meeting_member_special_opinion
            ADD CONSTRAINT fk_meeting_member_special_opinion_member FOREIGN KEY (meeting_member_id)
            REFERENCES meeting_member (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            CREATE TABLE meeting_protocol
            (
            id              bigint      NOT NULL primary key,
            created         timestamp,
            updated         timestamp,
            author_id       bigint,
            meeting_id      bigint,
            binary_info_id  bigint
            );

            ALTER TABLE meeting_protocol
            ADD CONSTRAINT fk_meeting_protocol_user FOREIGN KEY (author_id)
            REFERENCES app_user (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE meeting_protocol
            ADD CONSTRAINT fk_meeting_protocol_binary_info FOREIGN KEY (binary_info_id)
            REFERENCES binary_info (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE meeting_protocol
            ADD CONSTRAINT fk_meeting_protocol_meeting FOREIGN KEY (meeting_id)
            REFERENCES meeting (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            CREATE TABLE regulatory_document
            (
            id                  bigint         NOT NULL primary key,
            created             timestamp,
            updated             timestamp,
            management_body_id  bigint,
            title               varchar(255),
            author_id           bigint,
            binary_info_id      bigint
            );

            ALTER TABLE regulatory_document
            ADD CONSTRAINT fk_regulatory_document_user FOREIGN KEY (author_id)
            REFERENCES app_user (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE regulatory_document
            ADD CONSTRAINT fk_regulatory_document_binary_info FOREIGN KEY (binary_info_id)
            REFERENCES binary_info (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE regulatory_document
            ADD CONSTRAINT fk_regulatory_document_body FOREIGN KEY (management_body_id)
            REFERENCES management_body (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            CREATE TABLE agenda_question
            (
            id                        bigint          NOT NULL,
            guid                      varchar(128),
            created                   timestamp,
            updated                   timestamp,
            agenda_question_status    varchar(255),
            description               varchar(1024),
            meeting_id                bigint,
            position                  integer         NOT NULL,
            question_type             varchar(255),
            quorum                    integer         NOT NULL,
            title                     varchar(1024),
            vote_limit                integer,
            required_votes_for_count  integer
            );

            ALTER TABLE agenda_question
            ADD CONSTRAINT agenda_question_pkey
            PRIMARY KEY (id);

            ALTER TABLE agenda_question
            ADD CONSTRAINT fk_agenda_question_meeting FOREIGN KEY (meeting_id)
            REFERENCES meeting (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE agenda_question
            ADD CONSTRAINT uk_agenda_question UNIQUE (guid);

            CREATE TABLE agenda_question_comment
            (
            id                  bigint          NOT NULL,
            created             timestamp,
            updated             timestamp,
            agenda_question_id  bigint,
            author_id           bigint,
            comment             varchar(1024)
            );

            ALTER TABLE agenda_question_comment
            ADD CONSTRAINT agenda_question_comment_pkey
            PRIMARY KEY (id);

            ALTER TABLE agenda_question_comment
            ADD CONSTRAINT fk_agenda_question_comment_question FOREIGN KEY (agenda_question_id)
            REFERENCES agenda_question (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE agenda_question_comment
            ADD CONSTRAINT fk_agenda_question_comment_user FOREIGN KEY (author_id)
            REFERENCES app_user (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            CREATE TABLE agenda_question_document
            (
            id                  bigint      NOT NULL,
            created             timestamp,
            updated             timestamp,
            agenda_question_id  bigint,
            author_id           bigint,
            binary_info_id      bigint
            );

            ALTER TABLE agenda_question_document
            ADD CONSTRAINT agenda_question_document_pkey
            PRIMARY KEY (id);

            ALTER TABLE agenda_question_document
            ADD CONSTRAINT fk_agenda_question_document_question FOREIGN KEY (agenda_question_id)
            REFERENCES agenda_question (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE agenda_question_document
            ADD CONSTRAINT fk_agenda_question_document_user FOREIGN KEY (author_id)
            REFERENCES app_user (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE agenda_question_document
            ADD CONSTRAINT fk_agenda_question_document_binary_info FOREIGN KEY (binary_info_id)
            REFERENCES binary_info (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            CREATE TABLE agenda_question_excluded_invited_member
            (
            id                  bigint   NOT NULL,
            agenda_question_id  bigint,
            member_id           bigint
            );

            ALTER TABLE agenda_question_excluded_invited_member
            ADD CONSTRAINT agenda_question_excluded_invited_member_pkey
            PRIMARY KEY (id);

            ALTER TABLE agenda_question_excluded_invited_member
            ADD CONSTRAINT fk_agenda_question_excluded_invited_member_quest FOREIGN KEY (agenda_question_id)
            REFERENCES agenda_question (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE agenda_question_excluded_invited_member
            ADD CONSTRAINT fk_agenda_question_excluded_invited_member_member FOREIGN KEY (member_id)
            REFERENCES meeting_member (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            CREATE TABLE agenda_question_excluded_member
            (
            id                  bigint         NOT NULL,
            agenda_question_id  bigint,
            can_discuss         boolean        NOT NULL,
            can_vote            boolean        NOT NULL,
            member_id           bigint,
            reason              varchar(512)
            );

            ALTER TABLE agenda_question_excluded_member
            ADD CONSTRAINT agenda_question_excluded_member_pkey
            PRIMARY KEY (id);

            ALTER TABLE agenda_question_excluded_member
            ADD CONSTRAINT fk_agenda_question_excluded_member_quest FOREIGN KEY (agenda_question_id)
            REFERENCES agenda_question (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE agenda_question_excluded_member
            ADD CONSTRAINT fk_agenda_question_excluded_member_member FOREIGN KEY (member_id)
            REFERENCES meeting_member (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            CREATE TABLE agenda_question_link
            (
            id                  bigint         NOT NULL,
            agenda_question_id  bigint,
            author_id           bigint,
            title               varchar(128),
            url                 varchar(255)
            );

            ALTER TABLE agenda_question_link
            ADD CONSTRAINT fk_agenda_question_link_quest FOREIGN KEY (agenda_question_id)
            REFERENCES agenda_question (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE agenda_question_link
            ADD CONSTRAINT fk_agenda_question_link_user FOREIGN KEY (author_id)
            REFERENCES app_user (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            CREATE TABLE agenda_question_template
            (
            id                        bigint          NOT NULL,
            created                   timestamp,
            updated                   timestamp,
            description               varchar(1024),
            management_body_id        bigint,
            question_type             varchar(255),
            quorum                    integer         NOT NULL,
            title                     varchar(255),
            vote_limit                integer,
            required_votes_for_count  integer
            );

            ALTER TABLE agenda_question_template
            ADD CONSTRAINT agenda_question_template_pkey
            PRIMARY KEY (id);

            ALTER TABLE agenda_question_template
            ADD CONSTRAINT fk_agenda_question_template_body FOREIGN KEY (management_body_id)
            REFERENCES management_body (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            CREATE TABLE agenda_question_template_document
            (
            id                           bigint      NOT NULL,
            created                      timestamp,
            updated                      timestamp,
            agenda_question_template_id  bigint,
            author_id                    bigint,
            binary_info_id               bigint
            );

            ALTER TABLE agenda_question_template_document
            ADD CONSTRAINT agenda_question_template_document_pkey
            PRIMARY KEY (id);

            ALTER TABLE agenda_question_template_document
            ADD CONSTRAINT fk_agenda_question_template_document_qt FOREIGN KEY (agenda_question_template_id)
            REFERENCES agenda_question_template (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE agenda_question_template_document
            ADD CONSTRAINT fk_agenda_question_template_document_user FOREIGN KEY (author_id)
            REFERENCES app_user (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            CREATE TABLE agenda_question_template_link
            (
            id                           bigint         NOT NULL,
            created                      timestamp,
            updated                      timestamp,
            agenda_question_template_id  bigint,
            author_id                    bigint,
            title                        varchar(128),
            url                          varchar(255)
            );

            ALTER TABLE agenda_question_template_link
            ADD CONSTRAINT agenda_question_template_link_pkey
            PRIMARY KEY (id);

            ALTER TABLE agenda_question_template_link
            ADD CONSTRAINT fk_agenda_question_template_link_qt FOREIGN KEY (agenda_question_template_id)
            REFERENCES agenda_question_template (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE agenda_question_template_link
            ADD CONSTRAINT fk_agenda_question_template_link_user FOREIGN KEY (author_id)
            REFERENCES app_user (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE agenda_question_template_document
            ADD CONSTRAINT fkiluun813evcw2hw3qvwjpw6id FOREIGN KEY (binary_info_id)
            REFERENCES binary_info (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            CREATE TABLE agenda_question_template_variant
            (
            id                           bigint          NOT NULL,
            agenda_question_template_id  bigint,
            title                        varchar(1024)
            );

            ALTER TABLE agenda_question_template_variant
            ADD CONSTRAINT agenda_question_template_variant_pkey
            PRIMARY KEY (id);

            ALTER TABLE agenda_question_template_variant
            ADD CONSTRAINT fk_agenda_question_template_variant_qt FOREIGN KEY (agenda_question_template_id)
            REFERENCES agenda_question_template (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            CREATE TABLE agenda_question_variant
            (
            id                  bigint          NOT NULL,
            agenda_question_id  bigint,
            title               varchar(5400)
            );

            ALTER TABLE agenda_question_variant
            ADD CONSTRAINT agenda_question_variant_pkey
            PRIMARY KEY (id);

            ALTER TABLE agenda_question_variant
            ADD CONSTRAINT fk_agenda_question_variant_quest FOREIGN KEY (agenda_question_id)
            REFERENCES agenda_question (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            CREATE TABLE vote
            (
            id                   bigint         NOT NULL,
            question_id          bigint,
            created              timestamp,
            meeting_member_id    bigint,
            question_variant_id  bigint,
            updated              timestamp,
            vote_type            varchar(255)
            );

            ALTER TABLE vote
            ADD CONSTRAINT vote_pkey
            PRIMARY KEY (id);

            ALTER TABLE vote
            ADD CONSTRAINT fk_vote_quest FOREIGN KEY (question_id)
            REFERENCES agenda_question (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE vote
            ADD CONSTRAINT fk_vote_quest_variant FOREIGN KEY (question_variant_id)
            REFERENCES agenda_question_variant (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            CREATE TABLE vote_history
            (
            id                   bigint         NOT NULL,
            question_id          bigint,
            created              timestamp,
            meeting_member_id    bigint,
            question_variant_id  bigint,
            vote_type            varchar(255)
            );

            ALTER TABLE vote_history
            ADD CONSTRAINT vote_history_pkey
            PRIMARY KEY (id);

            ALTER TABLE vote_history
            ADD CONSTRAINT fk_vote_history_quest FOREIGN KEY (question_id)
            REFERENCES agenda_question (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE vote_history
            ADD CONSTRAINT fk_vote_history_quest_variant FOREIGN KEY (question_variant_id)
            REFERENCES agenda_question_variant (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            ALTER TABLE vote_history
            ADD CONSTRAINT fk_vote_history_member FOREIGN KEY (meeting_member_id)
            REFERENCES meeting_member (id)
            ON UPDATE NO ACTION
            ON DELETE NO ACTION;

            INSERT INTO app_role (id,code,name,system) VALUES (27,'USER','roles.user',FALSE);
            INSERT INTO app_role (id,code,name,system) VALUES (1,'OPERATOR','roles.operator',TRUE);
            INSERT INTO app_role (id,code,name,system) VALUES (10,'ADMIN','roles.administrator',FALSE);

            INSERT INTO app_role_authority (id,authority_code,role_id) VALUES (2, 1, 1),(3,2,1),(4,8,1),(5,9,1),(6,10,1),(7,11,1),(8,12,1),(9,33,1),(11,8,10),(12,9,10),
            (13,10,10),(14,11,10),(15,12,10),(16,33,10),(17,3,10),(18,4,10),(19,5,10),(20,13,10),(21,14,10),(22,15,10),(23,16,10),(24,17,10),(25,18,10),(26,19,10),
            (28,25,27),(29,26,27),(30,29,27),(31,32,27),(32,34,27),(124,35,10),(125,36,10),(126,35,27),(127,36,27);

            INSERT INTO app_user
            (id,created,updated,active,addition_information,agreement_accepted,deleted,email,first_name,
            group_id,last_name,login,middle_name,password,password_changed,phone,POSITION,postal_address,
            avatar_id,preffered_locale)
            VALUES (1, current_timestamp, current_timestamp, TRUE, NULL,
            FALSE, FALSE, 'operator@mail.com', 'Оператор', NULL, 'Оператор',
            'operator', NULL, '$2a$11$pificxNR.xE0pYPnavv5GuLB/oWF6knzvpKDbciijrQkWpyeuYDkK', FALSE,
            NULL, NULL, NULL, NULL,'ru'
            );
            insert into app_user_role (user_id,role_id) values (1,1);
        </sql>
    </changeSet>
</databaseChangeLog>
